/*****************************************************************************
 *                  IMPINJ CONFIDENTIAL AND PROPRIETARY                      *
 *                                                                           *
 * This source code is the property of Impinj, Inc. Your use of this source  *
 * code in whole or in part is subject to your applicable license terms      *
 * from Impinj.                                                              *
 * Contact support@impinj.com for a copy of the applicable Impinj license    *
 * terms.                                                                    *
 *                                                                           *
 * (c) Copyright 2022 Impinj, Inc. All rights reserved.                      *
 *                                                                           *
 *****************************************************************************/

#include "rssi_compensation_lut.h"

/**
 * RSSI Compensation Look Up Table
 * These variables are look up tables used for RSSI compensation.
 *
 * These values are derived empirically but do not vary significantly from
 * part to part as they are digital offsets. These values, combined with
 * calibration data are used in unison to compensate for RSSI.
 */

const struct RssiCompensationLut rssi_compensation = {
    .rf_modes = {1,   124, 323, 3,   123, 222, 324, 5,   141, 241, 342,
                 7,   146, 244, 343, 11,  102, 302, 12,  125, 223, 325,
                 13,  185, 285, 382, 15,  147, 344, 103, 148, 345, 120,
                 186, 286, 383, 126, 224, 326, 202, 9},
    .rf_mode_to_rx_mode = {RX_MODE_12_IDX, RX_MODE_12_IDX, RX_MODE_12_IDX,
                           RX_MODE_11_IDX, RX_MODE_11_IDX, RX_MODE_11_IDX,
                           RX_MODE_11_IDX, RX_MODE_17_IDX, RX_MODE_17_IDX,
                           RX_MODE_17_IDX, RX_MODE_17_IDX, RX_MODE_16_IDX,
                           RX_MODE_16_IDX, RX_MODE_16_IDX, RX_MODE_16_IDX,
                           RX_MODE_6_IDX,  RX_MODE_6_IDX,  RX_MODE_6_IDX,
                           RX_MODE_11_IDX, RX_MODE_11_IDX, RX_MODE_11_IDX,
                           RX_MODE_11_IDX, RX_MODE_21_IDX, RX_MODE_21_IDX,
                           RX_MODE_21_IDX, RX_MODE_21_IDX, RX_MODE_18_IDX,
                           RX_MODE_18_IDX, RX_MODE_18_IDX, RX_MODE_6_IDX,
                           RX_MODE_18_IDX, RX_MODE_18_IDX, RX_MODE_12_IDX,
                           RX_MODE_23_IDX, RX_MODE_23_IDX, RX_MODE_23_IDX,
                           RX_MODE_11_IDX, RX_MODE_11_IDX, RX_MODE_11_IDX,
                           RX_MODE_5_IDX,  RX_MODE_21_IDX},
    .rx_modes_drm =
        {
            0,
            0,
            0,
            0,
            1,
            1,
            0,
            0,
            1,
            0,
        },
    .rx_modes_blf_khz =
        {
            426,
            640,
            320,
            640,
            250,
            320,
            640,
            160,
            320,
            640,
        },
    .calibration_modes = {1, 3, 5, 7, 11, 12, 13, 15},
    .calibration_modes_blf_digital_offset =
        {
            83,
            -2,
            17,
            -35,
            129,
            -2,
            0,
            105,
        },
    .digital_frequency_points =
        {
            0,   9,   18,  27,  36,  45,  55,  64,  73,   82,   91,   100,  109,
            118, 127, 136, 145, 155, 160, 164, 173, 182,  191,  200,  209,  218,
            227, 236, 245, 250, 255, 264, 273, 282, 291,  300,  309,  318,  320,
            327, 336, 345, 355, 364, 373, 382, 391, 400,  450,  504,  557,  611,
            640, 664, 718, 771, 825, 879, 932, 986, 1039, 1093, 1146, 1200,
        },
    .rx_mode_digital_correction =
        {
            // 5
            {216, -397, -436, -340, -250, -178, -117, -71,  -38, -10, 14,
             31,  42,   50,   54,   55,   52,   48,   43,   43,  34,  26,
             17,  8,    2,    -1,   -4,   -2,   0,    0,    5,   11,  16,
             22,  29,   33,   36,   38,   36,   40,   38,   37,  34,  29,
             27,  23,   20,   16,   22,   42,   36,   30,   36,  43,  49,
             43,  8,    -262, -558, -541, -522, -492, -464, -430},

            // 6
            {
                345, -323, -420, -391, -374, -324, -274, -220, -178, -138, -104,
                -74, -47,  -23,  -2,   18,   34,   51,   58,   64,   76,   84,
                95,  104,  110,  115,  120,  124,  126,  128,  128,  128,  128,
                129, 128,  126,  124,  121,  122,  118,  115,  111,  108,  105,
                99,  93,   91,   88,   75,   85,   106,  122,  128,  130,  123,
                115, 114,  118,  131,  143,  150,  151,  138,  110,
            },
            // 11
            {
                166,  -479, -561, -567, -544, -507, -471, -439, -409, -378,
                -352, -328, -302, -280, -260, -240, -222, -205, -193, -187,
                -172, -158, -143, -129, -116, -104, -92,  -81,  -71,  -65,
                -60,  -53,  -43,  -34,  -25,  -17,  -12,  -6,   -1,   3,
                9,    14,   21,   25,   30,   33,   40,   42,   59,   70,
                75,   38,   -62,  -229, -541, -485, -441, -385, -337, -310,
                -269, -232, -192, -152,
            },
            // 12
            {
                401,  -250, -466, -500, -426, -512, -434, -488, -428, -420,
                -408, -420, -403, -371, -359, -354, -339, -323, -315, -311,
                -297, -283, -270, -259, -247, -234, -223, -213, -201, -197,
                -190, -180, -172, -161, -152, -143, -134, -125, -122, -116,
                -107, -101, -92,  -85,  -77,  -70,  -63,  -54,  -20,  13,
                43,   68,   81,   91,   109,  126,  140,  151,  160,  167,
                174,  178,  171,  148,
            },
            // 16
            {
                141,  309,  139,  128,  27,   -83,  -193, -295, -379, -473,
                -550, -558, -491, -412, -346, -290, -243, -205, -186, -176,
                -152, -130, -114, -101, -88,  -73,  -63,  -51,  -41,  -36,
                -32,  -22,  -13,  -6,   4,    12,   17,   21,   22,   24,
                22,   12,   -3,   -25,  -58,  -101, -157, -228, -562, -421,
                -284, -160, -78,  -40,  78,   178,  256,  347,  426,  477,
                515,  558,  587,  608,
            },
            // 17
            {
                143,  338,  141,  137,  59,   -43,  -169, -274, -358, -453,
                -549, -631, -673, -659, -590, -500, -415, -340, -300, -278,
                -226, -184, -152, -125, -106, -87,  -75,  -63,  -52,  -46,
                -41,  -32,  -24,  -15,  -5,   2,    8,    15,   18,   23,
                28,   32,   40,   45,   49,   55,   59,   62,   48,   -192,
                -280, -150, -76,  -34,  71,   178,  264,  358,  407,  479,
                536,  574,  603,  615,
            },
            // 18
            {
                -104, -414, -517, -562, -586, -602, -608, -618, -620, -625,
                -626, -630, -628, -630, -628, -629, -630, -630, -630, -628,
                -628, -623, -619, -607, -590, -569, -541, -510, -475, -456,
                -439, -406, -372, -340, -311, -283, -256, -231, -225, -206,
                -184, -164, -145, -126, -110, -94,  -79,  -65,  -6,   38,
                66,   92,   103,  114,  133,  150,  155,  142,  99,   15,
                -128, -316, -315, -263,
            },
            // 21
            {
                -117, -671, -773, -822, -846, -861, -872, -871, -873, -874,
                -825, -578, -369, -222, -127, -67,  -31,  -11,  -2,   2,
                9,    2,    -27,  -89,  -199, -368, -622, -875, -893, -892,
                -890, -886, -883, -877, -869, -860, -845, -831, -828, -822,
                -803, -790, -773, -755, -737, -723, -702, -692, -601, -536,
                -469, -406, -369, -341, -287, -232, -184, -140, -97,  -57,
                -23,  13,   43,   74,
            },
            // 23
            {
                -100, 438,  326,  259,  175,  58,   -45,  -155, -245, -330,
                -424, -504, -556, -572, -568, -566, -558, -557, -556, -557,
                -559, -557, -543, -493, -403, -312, -235, -171, -115, -92,
                -71,  -38,  -12,  9,    25,   37,   44,   53,   55,   60,
                63,   67,   66,   62,   50,   33,   7,    -28,  -429, -360,
                -222, -92,  -21,  29,   140,  242,  334,  425,  499,  581,
                647,  669,  724,  744,
            },
            // 36
            {
                187,  -415, -515, -555, -580, -595, -607, -607, -619, -615,
                -625, -627, -622, -619, -620, -628, -628, -629, -630, -625,
                -627, -624, -616, -607, -590, -569, -540, -508, -474, -455,
                -439, -404, -370, -339, -310, -282, -256, -229, -225, -206,
                -184, -164, -143, -124, -109, -94,  -79,  -64,  -5,   39,
                67,   93,   105,  115,  134,  150,  156,  142,  100,  17,
                -128, -314, -316, -275,
            },
        },
    .lbt_digital_correction = 46,
    .lbt_cordic_freq_shift  = 200,
};

struct RssiCompensationLut const* get_ex10_rssi_compensation(void)
{
    return &rssi_compensation;
}
